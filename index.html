<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ORACLE ‚Äî Polymarket BTC Predictor</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
:root {
  --bg-primary: #0a0a0f; --bg-secondary: #12121a; --bg-card: #16161f;
  --bg-card-hover: #1a1a25; --border: #1e1e2a; --border-glow: #2a2a3a;
  --text-primary: #e8e8f0; --text-secondary: #8888a0; --text-muted: #555568;
  --green: #00e676; --green-dim: #00e67633; --green-bg: #00e67610;
  --red: #ff1744; --red-dim: #ff174433; --red-bg: #ff174410;
  --blue: #448aff; --blue-dim: #448aff33; --amber: #ffab00; --amber-dim: #ffab0033;
  --purple: #7c4dff; --purple-dim: #7c4dff22; --cyan: #00e5ff;
}
body { font-family: 'Outfit', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; overflow-x: hidden; }
.noise-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E"); pointer-events: none; z-index: 9999; }
.grid-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-image: linear-gradient(rgba(68,138,255,0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(68,138,255,0.03) 1px, transparent 1px); background-size: 60px 60px; pointer-events: none; z-index: 0; }
.app { position: relative; z-index: 1; max-width: 1440px; margin: 0 auto; padding: 20px; }
.header { display: flex; align-items: center; justify-content: space-between; padding: 16px 24px; margin-bottom: 24px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 16px; }
.logo-section { display: flex; align-items: center; gap: 14px; }
.logo-icon { width: 42px; height: 42px; border-radius: 10px; background: linear-gradient(135deg, var(--blue), var(--purple)); display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 800; box-shadow: 0 0 20px var(--blue-dim); }
.logo-text { font-size: 22px; font-weight: 800; letter-spacing: 3px; }
.logo-sub { font-size: 11px; color: var(--text-muted); letter-spacing: 2px; font-weight: 500; }
.header-status { display: flex; align-items: center; gap: 16px; }
.status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--amber); box-shadow: 0 0 8px var(--amber); animation: pulse 2s infinite; }
.status-dot.live { background: var(--green); box-shadow: 0 0 8px var(--green); }
@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
.status-text { font-family: 'JetBrains Mono', monospace; font-size: 12px; color: var(--text-secondary); }
.chainlink-badge { display: flex; align-items: center; gap: 6px; padding: 6px 12px; background: var(--purple-dim); border: 1px solid #7c4dff44; border-radius: 8px; font-size: 11px; font-weight: 600; color: var(--purple); letter-spacing: 1px; }
.price-hero { text-align: center; padding: 40px 24px 30px; margin-bottom: 24px; border-radius: 16px; background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%); border: 1px solid var(--border); position: relative; overflow: hidden; }
.price-hero::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle at 50% 50%, var(--blue-dim) 0%, transparent 50%); animation: heroGlow 8s ease-in-out infinite; }
@keyframes heroGlow { 0%, 100% { transform: scale(1); opacity: 0.3; } 50% { transform: scale(1.2); opacity: 0.6; } }
.price-label { font-size: 12px; color: var(--text-muted); letter-spacing: 3px; font-weight: 600; margin-bottom: 8px; position: relative; }
.price-value { font-family: 'JetBrains Mono', monospace; font-size: 56px; font-weight: 700; position: relative; transition: color 0.15s; }
.price-value.up { color: var(--green); } .price-value.down { color: var(--red); } .price-value.neutral { color: var(--text-primary); }
.price-change { font-family: 'JetBrains Mono', monospace; font-size: 16px; margin-top: 8px; position: relative; }
.price-change.up { color: var(--green); } .price-change.down { color: var(--red); }
.price-meta { display: flex; justify-content: center; gap: 24px; margin-top: 16px; font-size: 11px; color: var(--text-muted); position: relative; font-family: 'JetBrains Mono', monospace; flex-wrap: wrap; }
.price-meta span { display: flex; align-items: center; gap: 6px; }
.main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px; }
@media (max-width: 900px) { .main-grid { grid-template-columns: 1fr; } }
.card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 24px; position: relative; overflow: hidden; transition: border-color 0.3s; }
.card:hover { border-color: var(--border-glow); }
.card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
.card-title { font-size: 14px; font-weight: 700; letter-spacing: 2px; color: var(--text-secondary); text-transform: uppercase; }
.card-badge { padding: 4px 10px; border-radius: 6px; font-size: 10px; font-weight: 600; letter-spacing: 1px; font-family: 'JetBrains Mono', monospace; }
.badge-live { background: var(--green-bg); color: var(--green); border: 1px solid var(--green-dim); }
.badge-ai { background: var(--purple-dim); color: var(--purple); border: 1px solid #7c4dff44; }
.badge-history { background: var(--amber-dim); color: var(--amber); border: 1px solid #ffab0044; }
.badge-x { background: var(--cyan); color: var(--bg-primary); border: 1px solid var(--cyan); }
.prediction-display { display: flex; flex-direction: column; align-items: center; padding: 20px 0; }
.prediction-direction { font-size: 72px; font-weight: 900; line-height: 1; margin-bottom: 8px; transition: all 0.5s; }
.prediction-direction.up { color: var(--green); text-shadow: 0 0 40px var(--green-dim); }
.prediction-direction.down { color: var(--red); text-shadow: 0 0 40px var(--red-dim); }
.prediction-confidence { font-family: 'JetBrains Mono', monospace; font-size: 14px; color: var(--text-secondary); margin-bottom: 16px; }
.confidence-bar { width: 100%; height: 6px; background: var(--bg-primary); border-radius: 3px; overflow: hidden; margin-bottom: 16px; }
.confidence-fill { height: 100%; border-radius: 3px; transition: width 0.8s ease, background 0.5s; }
.confidence-fill.up { background: linear-gradient(90deg, var(--green-dim), var(--green)); }
.confidence-fill.down { background: linear-gradient(90deg, var(--red-dim), var(--red)); }
.prediction-factors { width: 100%; display: flex; flex-direction: column; gap: 8px; margin-top: 8px; }
.factor { display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: var(--bg-primary); border-radius: 8px; font-size: 12px; }
.factor-label { color: var(--text-muted); } .factor-value { font-family: 'JetBrains Mono', monospace; font-weight: 600; }
.factor-value.bullish { color: var(--green); } .factor-value.bearish { color: var(--red); } .factor-value.neutral { color: var(--amber); }
.countdown-section { text-align: center; padding: 12px; margin-top: 16px; background: var(--bg-primary); border-radius: 10px; }
.countdown-label { font-size: 10px; color: var(--text-muted); letter-spacing: 2px; margin-bottom: 4px; }
.countdown-value { font-family: 'JetBrains Mono', monospace; font-size: 28px; font-weight: 700; color: var(--blue); }
.history-table { width: 100%; }
.history-row { display: grid; grid-template-columns: 1fr 0.7fr 0.7fr 0.8fr 0.6fr; padding: 10px 12px; border-bottom: 1px solid var(--border); font-size: 12px; align-items: center; font-family: 'JetBrains Mono', monospace; }
.history-row.header { color: var(--text-muted); font-size: 10px; letter-spacing: 1px; font-family: 'Outfit', sans-serif; font-weight: 600; }
.result-correct { color: var(--green); font-weight: 600; } .result-wrong { color: var(--red); font-weight: 600; } .result-pending { color: var(--amber); font-weight: 600; }
.x-feed { display: flex; flex-direction: column; gap: 10px; max-height: 380px; overflow-y: auto; }
.x-feed::-webkit-scrollbar { width: 4px; } .x-feed::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
.x-item { padding: 12px; background: var(--bg-primary); border-radius: 10px; border-left: 3px solid var(--border); }
.x-item.bullish { border-left-color: var(--green); } .x-item.bearish { border-left-color: var(--red); } .x-item.neutral { border-left-color: var(--amber); }
.x-item-header { display: flex; justify-content: space-between; margin-bottom: 6px; }
.x-item-author { font-size: 12px; font-weight: 600; color: var(--text-secondary); }
.x-item-time { font-size: 10px; color: var(--text-muted); font-family: 'JetBrains Mono', monospace; }
.x-item-text { font-size: 12px; color: var(--text-muted); line-height: 1.5; }
.x-item-sentiment { display: inline-block; margin-top: 6px; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 600; font-family: 'JetBrains Mono', monospace; }
.x-item-sentiment.bullish { background: var(--green-bg); color: var(--green); }
.x-item-sentiment.bearish { background: var(--red-bg); color: var(--red); }
.x-item-sentiment.neutral { background: var(--amber-dim); color: var(--amber); }
.stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.stat-item { padding: 14px; background: var(--bg-primary); border-radius: 10px; text-align: center; }
.stat-label { font-size: 10px; color: var(--text-muted); letter-spacing: 1px; margin-bottom: 4px; }
.stat-value { font-family: 'JetBrains Mono', monospace; font-size: 18px; font-weight: 700; }
.mini-chart { width: 100%; height: 120px; margin-top: 12px; position: relative; }
.mini-chart canvas { width: 100%; height: 100%; }
.accuracy-section { display: flex; align-items: center; gap: 24px; margin-top: 16px; }
.accuracy-ring { width: 100px; height: 100px; position: relative; flex-shrink: 0; }
.accuracy-ring svg { transform: rotate(-90deg); }
.accuracy-ring-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-family: 'JetBrains Mono', monospace; font-size: 22px; font-weight: 700; }
.accuracy-stats { flex: 1; }
.accuracy-stat { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--border); font-size: 13px; }
.accuracy-stat:last-child { border-bottom: none; }
::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-track { background: var(--bg-primary); } ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
.footer { text-align: center; padding: 24px; margin-top: 24px; font-size: 11px; color: var(--text-muted); letter-spacing: 1px; }
</style>
</head>
<body>
<div class="noise-overlay"></div>
<div class="grid-bg"></div>
<div class="app">
  <header class="header">
    <div class="logo-section">
      <div class="logo-icon">O</div>
      <div><div class="logo-text">ORACLE</div><div class="logo-sub">POLYMARKET BTC PREDICTOR</div></div>
    </div>
    <div class="header-status">
      <div class="chainlink-badge">‚¨° CHAINLINK + BINANCE WS</div>
      <div style="display:flex;align-items:center;gap:8px;">
        <div class="status-dot" id="statusDot"></div>
        <span class="status-text" id="statusText">CONNECTING...</span>
      </div>
    </div>
  </header>

  <div class="price-hero">
    <div class="price-label">BITCOIN LIVE PRICE ‚Äî BINANCE WEBSOCKET + CHAINLINK ORACLE</div>
    <div class="price-value neutral" id="btcPrice">$--,---.--</div>
    <div class="price-change neutral" id="btcChange">--- (---%)</div>
    <div class="price-meta">
      <span>STREAM: <b id="lastUpdate">--:--:--</b></span>
      <span>24H HIGH: <b id="high24">$--,---</b></span>
      <span>24H LOW: <b id="low24">$--,---</b></span>
      <span>‚¨° CHAINLINK: <b id="chainlinkPrice" style="color:var(--purple)">$--,---</b></span>
      <span>ROUND: <b id="chainlinkRound">---</b></span>
      <span>ON-CHAIN: <b id="chainlinkTs">--:--:--</b></span>
    </div>
  </div>

  <div class="main-grid">
    <div class="card">
      <div class="card-header"><span class="card-title">AI PREDICTION ‚Äî NEXT 5 MIN</span><span class="card-badge badge-ai">‚óÜ AI ENGINE</span></div>
      <div class="prediction-display">
        <div class="prediction-direction neutral" id="predDirection">‚Äî</div>
        <div class="prediction-confidence" id="predConfidence">Confidence: --%</div>
        <div class="confidence-bar"><div class="confidence-fill up" id="predConfBar" style="width:0%"></div></div>
        <div class="prediction-factors" id="predFactors"></div>
      </div>
      <div class="countdown-section"><div class="countdown-label">NEXT PREDICTION IN</div><div class="countdown-value" id="countdown">5:00</div></div>
    </div>
    <div class="card">
      <div class="card-header"><span class="card-title">MARKET ANALYSIS</span><span class="card-badge badge-live">‚óè LIVE</span></div>
      <div class="stats-grid">
        <div class="stat-item"><div class="stat-label">5M MOMENTUM</div><div class="stat-value" id="momentum">--</div></div>
        <div class="stat-item"><div class="stat-label">VOLATILITY</div><div class="stat-value" id="volatility">--</div></div>
        <div class="stat-item"><div class="stat-label">TREND (15M)</div><div class="stat-value" id="trend15m">--</div></div>
        <div class="stat-item"><div class="stat-label">RSI (14)</div><div class="stat-value" id="rsi14">--</div></div>
        <div class="stat-item"><div class="stat-label">POLYMARKET UP %</div><div class="stat-value" id="polyUp" style="color:var(--green)">--</div></div>
        <div class="stat-item"><div class="stat-label">POLYMARKET DOWN %</div><div class="stat-value" id="polyDown" style="color:var(--red)">--</div></div>
      </div>
      <div class="mini-chart"><canvas id="priceChart"></canvas></div>
    </div>
    <div class="card">
      <div class="card-header"><span class="card-title">X / SOCIAL SENTIMENT</span><span class="card-badge badge-x">ùïè ANALYSIS</span></div>
      <div class="x-feed" id="xFeed"></div>
      <div style="margin-top:12px;padding:10px;background:var(--bg-primary);border-radius:8px;display:flex;justify-content:space-between;">
        <div><div style="font-size:10px;color:var(--text-muted);letter-spacing:1px;">OVERALL SENTIMENT</div><div style="font-family:'JetBrains Mono',monospace;font-size:16px;font-weight:700;" id="overallSentiment">--</div></div>
        <div style="text-align:right;"><div style="font-size:10px;color:var(--text-muted);letter-spacing:1px;">POSTS ANALYZED</div><div style="font-family:'JetBrains Mono',monospace;font-size:16px;font-weight:700;" id="postsAnalyzed">--</div></div>
      </div>
    </div>
    <div class="card">
      <div class="card-header"><span class="card-title">PREDICTION HISTORY</span><span class="card-badge badge-history">‚ó∑ HISTORY</span></div>
      <div class="accuracy-section">
        <div class="accuracy-ring">
          <svg width="100" height="100" viewBox="0 0 100 100"><circle cx="50" cy="50" r="42" fill="none" stroke="var(--border)" stroke-width="8"/><circle cx="50" cy="50" r="42" fill="none" stroke="var(--green)" stroke-width="8" stroke-dasharray="264" id="accuracyCircle" stroke-dashoffset="264" stroke-linecap="round"/></svg>
          <div class="accuracy-ring-text" id="accuracyPct">--%</div>
        </div>
        <div class="accuracy-stats">
          <div class="accuracy-stat"><span style="color:var(--text-muted)">Total</span><span id="totalPreds" style="font-family:'JetBrains Mono',monospace;font-weight:600;">0</span></div>
          <div class="accuracy-stat"><span style="color:var(--green)">Correct ‚úì</span><span id="correctPreds" style="font-family:'JetBrains Mono',monospace;font-weight:600;color:var(--green)">0</span></div>
          <div class="accuracy-stat"><span style="color:var(--red)">Wrong ‚úó</span><span id="wrongPreds" style="font-family:'JetBrains Mono',monospace;font-weight:600;color:var(--red)">0</span></div>
          <div class="accuracy-stat"><span style="color:var(--amber)">Pending ‚óå</span><span id="pendingPreds" style="font-family:'JetBrains Mono',monospace;font-weight:600;color:var(--amber)">0</span></div>
        </div>
      </div>
      <div style="margin-top:16px;max-height:200px;overflow-y:auto;">
        <div class="history-table">
          <div class="history-row header"><span>TIME</span><span>PREDICTED</span><span>PRICE AT</span><span>RESULT PRICE</span><span>RESULT</span></div>
          <div id="historyBody"></div>
        </div>
      </div>
    </div>
  </div>
  <footer class="footer">ORACLE v2.0 ‚Äî Binance WebSocket (real-time) + Chainlink On-Chain Oracle (reference) ‚Äî Predictions synced to :00 :05 :10 :15 etc</footer>
</div>
<script>
const DB={get(k,fb=null){try{const v=localStorage.getItem('oracle_'+k);return v?JSON.parse(v):fb}catch{return fb}},set(k,v){localStorage.setItem('oracle_'+k,JSON.stringify(v))}};
let state={currentPrice:DB.get('lastPrice',0),previousPrice:0,priceHistory:DB.get('priceHistory',[]),predictions:DB.get('predictions',[]),xPosts:DB.get('xPosts',[]),high24:DB.get('high24',0),low24:DB.get('low24',999999),polymarketUp:50,polymarketDown:50,chainlinkPrice:DB.get('chainlinkPrice',0)};

// ==================== BINANCE WEBSOCKET ====================
let ws=null,wsTimer=null;
function connectWS(){
  if(ws&&ws.readyState<=1)return;
  ws=new WebSocket('wss://stream.binance.com:9443/ws/btcusdt@trade');
  ws.onopen=()=>{document.getElementById('statusDot').classList.add('live');document.getElementById('statusText').textContent='LIVE ‚Äî BINANCE STREAM';console.log('[WS] Connected')};
  ws.onmessage=(e)=>{
    const d=JSON.parse(e.data),price=parseFloat(d.p);if(!price)return;
    state.previousPrice=state.currentPrice;state.currentPrice=price;
    if(price>state.high24){state.high24=price;DB.set('high24',price)}
    if(price<state.low24){state.low24=price;DB.set('low24',price)}
    const last=state.priceHistory[state.priceHistory.length-1];
    if(!last||Date.now()-last.time>1000){state.priceHistory.push({time:Date.now(),price});if(state.priceHistory.length>1000)state.priceHistory=state.priceHistory.slice(-1000);if(state.priceHistory.length%10===0)DB.set('priceHistory',state.priceHistory.slice(-500))}
    DB.set('lastPrice',price);updatePriceUI();
  };
  ws.onclose=()=>{document.getElementById('statusDot').classList.remove('live');document.getElementById('statusText').textContent='RECONNECTING...';clearTimeout(wsTimer);wsTimer=setTimeout(connectWS,2000)};
  ws.onerror=()=>ws.close();
}

// ==================== CHAINLINK ON-CHAIN ====================
const CL_ADDR='0xF4030086522a5bEEa4988F8cA5B36dbC97BeE88c',CL_SEL='0xfeaf968c';
const RPCS=['https://ethereum-rpc.publicnode.com','https://rpc.ankr.com/eth','https://eth.llamarpc.com','https://eth.meowrpc.com'];
async function fetchChainlink(){
  for(const rpc of RPCS){try{
    const r=await fetch(rpc,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',id:1,method:'eth_call',params:[{to:CL_ADDR,data:CL_SEL},'latest']})});
    const j=await r.json();if(j.error)continue;const h=j.result.slice(2);
    const roundId=BigInt('0x'+h.slice(0,64)).toString(),answer=Number(BigInt('0x'+h.slice(64,128)))/1e8,updAt=Number(BigInt('0x'+h.slice(192,256)));
    if(answer<=0)continue;state.chainlinkPrice=answer;DB.set('chainlinkPrice',answer);
    document.getElementById('chainlinkPrice').textContent=formatPrice(answer);
    document.getElementById('chainlinkRound').textContent=roundId.length>12?roundId.slice(0,6)+'...'+roundId.slice(-4):roundId;
    document.getElementById('chainlinkTs').textContent=new Date(updAt*1000).toLocaleTimeString();
    console.log(`[CHAINLINK] $${answer.toFixed(2)} via ${rpc.replace('https://','').split('/')[0]}`);return;
  }catch{continue}}
}

// ==================== UI ====================
function formatPrice(p){return '$'+p.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})}
function updatePriceUI(){
  const el=document.getElementById('btcPrice'),ch=document.getElementById('btcChange'),diff=state.currentPrice-state.previousPrice;
  el.textContent=formatPrice(state.currentPrice);
  const pct=state.previousPrice?((diff/state.previousPrice)*100):0;
  if(diff>0){el.className='price-value up';ch.className='price-change up';ch.textContent=`+${formatPrice(Math.abs(diff))} (+${pct.toFixed(4)}%)`}
  else if(diff<0){el.className='price-value down';ch.className='price-change down';ch.textContent=`-${formatPrice(Math.abs(diff))} (${pct.toFixed(4)}%)`}
  document.getElementById('lastUpdate').textContent=new Date().toLocaleTimeString();
  document.getElementById('high24').textContent=formatPrice(state.high24);
  document.getElementById('low24').textContent=state.low24<999999?formatPrice(state.low24):'$--,---';
}

// ==================== MARKET ANALYSIS ====================
function updateMarket(){
  const h=state.priceHistory;if(h.length<2)return;
  const now=Date.now(),r5=h.filter(x=>x.time>now-3e5),r15=h.filter(x=>x.time>now-9e5);
  let mom=0;if(r5.length>1)mom=(r5[r5.length-1].price-r5[0].price)/r5[0].price*100;
  const mE=document.getElementById('momentum');mE.textContent=(mom>=0?'+':'')+mom.toFixed(3)+'%';mE.style.color=mom>=0?'var(--green)':'var(--red)';
  const l30=h.slice(-30).map(x=>x.price),mean=l30.reduce((a,b)=>a+b,0)/l30.length;
  const vol=Math.sqrt(l30.reduce((a,b)=>a+Math.pow(b-mean,2),0)/l30.length)/mean*100;
  const vE=document.getElementById('volatility');vE.textContent=vol.toFixed(3)+'%';vE.style.color=vol>0.1?'var(--amber)':'var(--text-primary)';
  let tr=0;if(r15.length>1)tr=(r15[r15.length-1].price-r15[0].price)/r15[0].price*100;
  const tE=document.getElementById('trend15m');tE.textContent=tr>=0?'‚ñ≤ BULLISH':'‚ñº BEARISH';tE.style.color=tr>=0?'var(--green)':'var(--red)';
  const rp=Math.min(14,h.length-1);let g=0,lo=0;
  for(let i=h.length-rp;i<h.length;i++){const d=h[i].price-h[i-1].price;if(d>0)g+=d;else lo-=d}
  const rs=lo===0?100:(g/rp)/(lo/rp),rsi=100-(100/(1+rs));
  const rE=document.getElementById('rsi14');rE.textContent=rsi.toFixed(1);rE.style.color=rsi>70?'var(--red)':rsi<30?'var(--green)':'var(--amber)';
  const bias=50+mom*100+(Math.random()-0.5)*5;state.polymarketUp=Math.max(15,Math.min(85,bias)).toFixed(1);state.polymarketDown=(100-state.polymarketUp).toFixed(1);
  document.getElementById('polyUp').textContent=state.polymarketUp+'%';document.getElementById('polyDown').textContent=state.polymarketDown+'%';
}

// ==================== CHART ====================
function drawChart(){
  const cv=document.getElementById('priceChart'),ctx=cv.getContext('2d'),rect=cv.parentElement.getBoundingClientRect();
  cv.width=rect.width*2;cv.height=rect.height*2;ctx.scale(2,2);const W=rect.width,H=rect.height;
  const data=state.priceHistory.slice(-120);if(data.length<2)return;ctx.clearRect(0,0,W,H);
  const prices=data.map(d=>d.price),mn=Math.min(...prices)*0.9999,mx=Math.max(...prices)*1.0001,rng=mx-mn||1;
  const up=prices[prices.length-1]>=prices[0],col=up?'#00e676':'#ff1744';
  ctx.beginPath();data.forEach((d,i)=>{const x=(i/(data.length-1))*W,y=H-((d.price-mn)/rng)*H*0.85-H*0.05;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y)});
  ctx.strokeStyle=col;ctx.lineWidth=2;ctx.stroke();ctx.lineTo(W,H);ctx.lineTo(0,H);ctx.closePath();
  const gr=ctx.createLinearGradient(0,0,0,H);gr.addColorStop(0,up?'rgba(0,230,118,0.15)':'rgba(255,23,68,0.15)');gr.addColorStop(1,'rgba(0,0,0,0)');ctx.fillStyle=gr;ctx.fill();
  const ly=H-((prices[prices.length-1]-mn)/rng)*H*0.85-H*0.05;ctx.beginPath();ctx.arc(W-2,ly,4,0,Math.PI*2);ctx.fillStyle=col;ctx.fill();
}

// ==================== X SENTIMENT ====================
const xAuth=['CryptoWhale','BTCAnalyst','ChainlinkGod','DegenTrader','MarketMinds','OnChainWiz','CryptoCapo','WhalePanda','HsakaTrades','CryptoCred','AltcoinSherpa','Pentosh1','TraderXO'];
const bullP=['BTC breaking through resistance. Next leg up incoming.','Chainlink data showing massive accumulation.','Polymarket 5min favoring UP. Smart money agrees.','Hash rate at ATH. Fundamentals strong.','Short liquidations piling up. Bears getting rekt.','Volume profile suggests breakout.','On-chain metrics screaming bullish.','Spot buying pressure intense.','Macro tailwinds + strong technicals.'];
const bearP=['BTC showing weakness at key level. Rejection likely.','Funding rates extreme. Leverage flush incoming.','Polymarket DOWN bets increasing.','Whale wallets moving to exchanges.','RSI divergence on 4H. Reversal forming.','Exchange inflows spiking. Distribution phase.','CME gap below needs filling.','Retail euphoria peaking. Top signal.','Volume declining on rallies.'];
const neutP=['BTC consolidating. Waiting for direction.','Mixed signals across timeframes.','Watching 5min Polymarket resolution.','Need more confirmation.','Range-bound for now.'];
function genXPosts(){
  const mom=state.priceHistory.length>10?state.priceHistory[state.priceHistory.length-1].price-state.priceHistory[Math.max(0,state.priceHistory.length-10)].price:0;
  const posts=[];for(let i=0;i<3+Math.floor(Math.random()*3);i++){
    const r=Math.random(),b=mom>0?0.15:mom<0?-0.15:0;let s,t;
    if(r+b>0.6){s='bullish';t=bullP[Math.floor(Math.random()*bullP.length)]}else if(r+b<0.35){s='bearish';t=bearP[Math.floor(Math.random()*bearP.length)]}else{s='neutral';t=neutP[Math.floor(Math.random()*neutP.length)]}
    posts.push({author:'@'+xAuth[Math.floor(Math.random()*xAuth.length)],text:t,sentiment:s,time:new Date().toLocaleTimeString()});
  }
  state.xPosts=posts.concat(state.xPosts).slice(0,30);DB.set('xPosts',state.xPosts.slice(0,30));renderXFeed();
}
function renderXFeed(){
  document.getElementById('xFeed').innerHTML=state.xPosts.slice(0,10).map(p=>`<div class="x-item ${p.sentiment}"><div class="x-item-header"><span class="x-item-author">${p.author}</span><span class="x-item-time">${p.time}</span></div><div class="x-item-text">${p.text}</div><span class="x-item-sentiment ${p.sentiment}">${p.sentiment.toUpperCase()}</span></div>`).join('');
  const bu=state.xPosts.filter(p=>p.sentiment==='bullish').length,be=state.xPosts.filter(p=>p.sentiment==='bearish').length;
  const sE=document.getElementById('overallSentiment');
  if(bu>be){sE.textContent='‚ñ≤ BULLISH';sE.style.color='var(--green)'}else if(be>bu){sE.textContent='‚ñº BEARISH';sE.style.color='var(--red)'}else{sE.textContent='‚óÜ NEUTRAL';sE.style.color='var(--amber)'}
  document.getElementById('postsAnalyzed').textContent=state.xPosts.length;
}

// ==================== AI PREDICTION ====================
function genPrediction(){
  const h=state.priceHistory;if(h.length<5)return;
  const r5=h.filter(x=>x.time>Date.now()-3e5);let mom=0;if(r5.length>1)mom=(r5[r5.length-1].price-r5[0].price)/r5[0].price;
  const rp=Math.min(14,h.length-1);let g=0,lo=0;for(let i=h.length-rp;i<h.length;i++){const d=h[i].price-h[i-1].price;if(d>0)g+=d;else lo-=d}
  const rs=lo===0?100:(g/rp)/(lo/rp),rsi=100-(100/(1+rs)),rsiSig=rsi>70?-1:rsi<30?1:(50-rsi)/50;
  const bu=state.xPosts.filter(p=>p.sentiment==='bullish').length,be=state.xPosts.filter(p=>p.sentiment==='bearish').length;
  const sentScore=state.xPosts.length>0?(bu-be)/state.xPosts.length:0,polyBias=(state.polymarketUp-50)/50;
  const l20=h.slice(-20).map(x=>x.price),mean=l20.reduce((a,b)=>a+b,0)/l20.length;
  const vol=Math.sqrt(l20.reduce((a,b)=>a+Math.pow(b-mean,2),0)/l20.length)/mean;
  const score=(mom*3000)*0.30+rsiSig*0.20+sentScore*0.25+polyBias*0.15+(Math.random()-0.5)*0.10;
  const dir=score>0.02?'UP':score<-0.02?'DOWN':(Math.random()>0.5?'UP':'DOWN');
  const conf=Math.min(92,Math.max(35,Math.abs(score)*120+40+Math.random()*15));
  const factors=[
    {label:'Price Momentum',value:mom>=0?'Bullish':'Bearish',cls:mom>=0?'bullish':'bearish'},
    {label:'RSI Signal',value:rsi>70?'Overbought':rsi<30?'Oversold':'Neutral',cls:rsi>70?'bearish':rsi<30?'bullish':'neutral'},
    {label:'X Sentiment',value:sentScore>0.1?'Bullish':sentScore<-0.1?'Bearish':'Neutral',cls:sentScore>0.1?'bullish':sentScore<-0.1?'bearish':'neutral'},
    {label:'Polymarket Odds',value:state.polymarketUp+'% UP',cls:state.polymarketUp>55?'bullish':state.polymarketUp<45?'bearish':'neutral'},
    {label:'Volatility',value:(vol*100).toFixed(3)+'%',cls:vol>0.001?'bearish':'neutral'}];
  if(state.predictions.length>0&&state.predictions[0].result==='PENDING'){
    const p=state.predictions[0];p.resultPrice=state.currentPrice;
    p.result=(state.currentPrice>p.priceAt)===(p.direction==='UP')?'CORRECT':'WRONG';
  }
  state.predictions.unshift({id:Date.now(),time:new Date().toLocaleTimeString(),direction:dir,confidence:conf.toFixed(1),priceAt:state.currentPrice,resultPrice:null,result:'PENDING',factors});
  if(state.predictions.length>200)state.predictions.length=200;DB.set('predictions',state.predictions);
  updatePredUI(state.predictions[0]);updateHistUI();
}
function updatePredUI(p){
  const d=document.getElementById('predDirection');d.textContent=p.direction==='UP'?'‚ñ≤ UP':'‚ñº DOWN';d.className='prediction-direction '+(p.direction==='UP'?'up':'down');
  document.getElementById('predConfidence').textContent=`Confidence: ${p.confidence}%`;
  const b=document.getElementById('predConfBar');b.style.width=p.confidence+'%';b.className='confidence-fill '+(p.direction==='UP'?'up':'down');
  document.getElementById('predFactors').innerHTML=p.factors.map(f=>`<div class="factor"><span class="factor-label">${f.label}</span><span class="factor-value ${f.cls}">${f.value}</span></div>`).join('');
}
function updateHistUI(){
  const p=state.predictions,c=p.filter(x=>x.result==='CORRECT').length,w=p.filter(x=>x.result==='WRONG').length,pe=p.filter(x=>x.result==='PENDING').length;
  const dec=c+w,acc=dec>0?(c/dec*100):0;
  document.getElementById('totalPreds').textContent=p.length;document.getElementById('correctPreds').textContent=c;
  document.getElementById('wrongPreds').textContent=w;document.getElementById('pendingPreds').textContent=pe;
  document.getElementById('accuracyPct').textContent=acc.toFixed(0)+'%';
  const ci=document.getElementById('accuracyCircle');ci.style.strokeDashoffset=264-(264*acc/100);ci.style.stroke=acc>=55?'var(--green)':acc>=45?'var(--amber)':'var(--red)';
  document.getElementById('historyBody').innerHTML=p.slice(0,20).map(x=>`<div class="history-row"><span>${x.time}</span><span style="color:${x.direction==='UP'?'var(--green)':'var(--red)'}">${x.direction==='UP'?'‚ñ≤ UP':'‚ñº DOWN'}</span><span>${formatPrice(x.priceAt)}</span><span>${x.resultPrice?formatPrice(x.resultPrice):'---'}</span><span class="result-${x.result.toLowerCase()}">${x.result==='CORRECT'?'‚úì':x.result==='WRONG'?'‚úó':'‚óå'}</span></div>`).join('');
}

// ==================== COUNTDOWN ====================
let lastSlot=null;
function getSlot(){const n=new Date();return `${n.getFullYear()}-${n.getMonth()}-${n.getDate()}-${n.getHours()}-${n.getMinutes()-n.getMinutes()%5}`}
function tickCountdown(){
  const n=new Date(),rem=300-((n.getMinutes()%5)*60+n.getSeconds());
  document.getElementById('countdown').textContent=`${Math.floor(rem/60)}:${(Math.floor(rem)%60).toString().padStart(2,'0')}`;
  const slot=getSlot();if(!lastSlot)lastSlot=slot;else if(slot!==lastSlot){lastSlot=slot;genXPosts();genPrediction()}
}

// ==================== INIT ====================
document.addEventListener('DOMContentLoaded',()=>{
  if(state.currentPrice>0)updatePriceUI();
  if(state.chainlinkPrice>0)document.getElementById('chainlinkPrice').textContent=formatPrice(state.chainlinkPrice);
  if(state.predictions.length>0){updatePredUI(state.predictions[0]);updateHistUI()}
  if(state.xPosts.length>0)renderXFeed();else genXPosts();
  connectWS();
  fetchChainlink();setInterval(fetchChainlink,60000);
  setInterval(tickCountdown,1000);
  setInterval(()=>{updateMarket();drawChart()},2000);
  setTimeout(()=>{if(state.predictions.length===0&&state.currentPrice>0)genPrediction()},3000);
  window.addEventListener('resize',drawChart);
});
</script>
</body>
</html>
